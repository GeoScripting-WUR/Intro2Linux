---
title: "Getting started with Linux (OS-GEOLive)"
subtitle: "The terminal, R, and Python"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    theme: united
    toc: yes
    toc_depth: 4
    number_sections: true
---

# Today in the morning

Read and do the below described tutorial

# Today's Learning objectives

- Knowing what Linux is (based on a presentation by Allard De Wit)
- Know how to use the **terminal**
- Learn the basics of `Bash` scripting
- Getting comfortable within OSGEO-Linux environment
    - running R from the terminal
    - Launching Rstudio and using Git
    - Running and writing Python script from the QGIS Python Console

# Using the terminal and command line

## Why using the command-line

Under Linux there are GUIs (graphical user interfaces), where you can point and click and drag, and hopefully get work done without first reading lots of documentation. The traditional Unix environment is a CLI (command line interface), where you type commands to tell the computer what to do. That is faster and more powerful, but requires finding out what the commands are ([reference](https://help.ubuntu.com/community/UsingTheTerminal)).

"man man" will bring up the manual entry for the man command, which is a good place to start!

```{r, eval=FALSE}
man man
```

"man intro" is especially useful - it displays the "Introduction to user commands" which is a well-written, fairly brief introduction to the Linux command line.

```{r, eval=FALSE}
man intro
```

There are many varieties of Linux, but almost all of them use similar commands that can be entered from a command-line interface terminal.

There are also many graphical user interfaces (GUIs), but each of them works differently and there is little standardization between them. Experienced users who work with many different Linux distributions therefore find it easier to learn commands that can be used in all varieties of Ubuntu and, indeed, in other Linux distributions as well.

## What is Bash?

`Bash`, the **Bourne-again-shell** (named after the author Stephen Bourne), scripting is one of the easiest types of scripting to learn, and is best compared to Windows `Batch` scripting via [DOS](http://en.wikipedia.org/wiki/DOS). `Bash` is very flexible, and has many advanced features that you won't see in batch scripts.

However if you are a 'non-computer-savvy' person that won't mean a thing to you. Bash is the language that you will learn to love as much of everyday Linux life is done/can be done using the Terminal. You will soon learn that most things can be done through both GUI (Graphical User Interface) and CLI (Command Line Interface), however some things are more easily achieved from one or the other. For example, changing file permissions of a folder and all its sub folders is more easily achieved using cli instead gui.

Bash, is the default shell on Linux and Mac OS X. Bash shell scripting, like also `R` or `Python`, allows multiple commands to be combined, facilitating automation.

A shell script (shell program) is a text file that contains commands that are interpreted by the shell (see below, we will learn how to write a shell script).

Each command can be linked in a script to combine several commands by providing the output of one as input to the other. Shell scripts can also contain the control structures common to the majority of programming languages (i.e. variables, logic constructs, looping constructs, functions and comments). The main distinction between shell programs and those written in C, C++, Java (to name but a few) is that shell programs are not compiled for execution, but are readily interpreted by the shell.

## What is the Shell?

At its base, a shell is simply a macro processor that executes commands.

## Launching the Shell: terminal!

**Keyboard Shortcut**: `Ctrl + Alt + T` 

Is not a "Terminator" but something really powerfull because via the terminal you get access to the CLI and it default Bash interface. The terminal is the engine behind linux and mac and can also be installed on Windows via a program called [Cygwin](https://www.cygwin.com) which provide a Linux interface on Windows. It is important as a geo-scripter to know about the Terminal as if will offer a lot of advantages. You'll see to more you will start scripting the more you will encounter the words "terminal", "shell", "bash", etc.


## Some commands

We will discuss useful everyday commands, as well as going a bit more in depth into scripting and semi-advanced features of Bash. Bash is not only used to run programs and applications, but it can also be used to write programs or scripts.

Most common commands:

- `pwd`: checking your current working directory
- `cd`: change directory
- `cd ..`: move up one directory
- `mkdir`: creating folders
- `rm` or `rm -R`: deleting files or folders
- `sudo`: opening applications as root (super-user, `su`) which requires your `su` pasword
- `ls`: listing files in a folder
- `cp`: copy files e.g. for backing up things or just copying. We will use these command it the scripts below.

Note!: Tab completion works from the terminal which is super-handy so that you never need to write filenames etc.

Let's get started! Launch your Virtual Machine, login (username: user, pasword: user) and use the File Manager to create the following folders, similar as you would do on your Windows computer.

![folders](figures/setup_folders.png)

Now open the terminal using the `Ctrl + Alt + T`  shortcut and go to this folder and list all the files within that folder. See the examples below:

Do you notice what the difference is between `ls`, `ls -l`, `ls -lh`?

![movingfolders](figures/MovingFolder_lsh.png)

The files like `main.R` and the `.Rproj` are created via Rstudio as we have learned in the previous lessons (setting up a local git repository). Go ahead and use Rstudio and create a new local Git Repository. There is no need to link this repository to a remote Repository yet (we will do this together in the lesson, and add the README.md by pulling from the GitHub.com page).

Create the `Bash` and a `R` folder (i.e. a folder that will contain our Bash Scripts, similar to the R folder)

```{r, eval=FALSE}
mkdir Bash
mkdir R
```

![createafolder](figures/createafolder.png)

Now let's use `pwd`, `cd`, and `cd ..` see what happens:

![pwdcd](figures/usingpwdcd.png)

So, that's it for now! It is just a brief intro, in order to get you started with some simple commands in the terminal. 

Try out other commands:

- make a directory and remove if (e.g. `mkdir -R namedirectory).
- create a Rscript via Rstudio, and the remove it via the terminal using `rm filename.R`.
- create another file an copy it and then remove it, etc.:

```{r, eval=FALSE}
cp source_file dest_file
rm dest_file
```

- use `ls` commands and it's options.

Read the `File & Directory Commands` section (https://help.ubuntu.com/community/UsingTheTerminal) and let me know if you have questions about some commands. 

## Scripting in the terminal

### Hello, world Bash script 
`Bash` is primarily a scripting language, so it would be a crime not to talk about scripting. Let's dive straight in with a `bash` script. More precisely the infamous "Hello World" script. You can create a bash script by opening your favorite text editor to edit your script and then saving it (typically the `.sh` file extension is used for your reference, but is not necessary. In our example, we will be using the `.sh` extension).

So let's get started. First, create a `Bash` folder within your R project folder (if it is not there yet). Within this folder create a simple text file using *Rstudio -> New File -> Text File* and call this file: `HelloWorld.sh` add the following text and save.

```{r, eval =FALSE, engine='bash'}
 #!/bin/bash         
echo "Hello, World"
```

The first line of the script just defines which interpreter to use (and where it is located). NOTE: There is no leading whitespace before #!/bin/bash. That's it, simple as that!'. To find out where your `bash` interpreter is located type the following in the terminal (this works also on a Mac terminal!):

```{r, engine='bash'}
which bash
```

Second, to run a bash script you first have to have the correct file permissions. We do this with `chmod` command in terminal (change mode) as follows:

```{r, eval=FALSE}
chmod a+x /where/i/saved/it/HelloWorld.sh   #Gives everyone execute permissions
```

More info about `chmod` (https://help.ubuntu.com/community/FilePermissions) for your future reference. Note: today is just an introduction to let you know what is possible so that you can find your way easier in the future.

So to do so, you can go to the terminal via the `Git` tab in `Rstudio` and click on `Shell...` and from there make sure you go to the `Bash` folder you created. Even better is that your launch the `Terminal` using the short-cut (`Ctrl + Alt + T`) and the `cd` command to move to the `Bash` folder (by the way this is just a name, you can select anyname you want). See here for some `Bash` lines:

```{r, eval=FALSE, engine='bash'}
echo "Go to the Bash folder"
cd Bash
echo "Check that the file is there using the ls command:"
ls
echo "Then change the permissions:"
chmod a+x HelloWorld.sh
echo "We can now run our first `Bash script`:"
./HelloWorld.sh
```

Hopefully you should have seen it print Hello, World!!! onto your screen. If so well done! That is your first `Bash` script (see below for a screenshot):

![BashScript](figures/Scripting.png)

**Question**: why do we add `./` in front of the Bash script?

Note!: we can also access the Terminal from R using the `system()` function that can invoke a OS command:

```{r, echo=TRUE, message=TRUE}
## R code
setwd("Bash/") ## set the working director in R
print(system("./HelloWorld.sh", intern = TRUE)) ## set this command to the Terminal
```


### Bash script with a variable

Variables basically store information. You set variables like this (you can type this in the terminal). 

```{r, eval=FALSE}
var="FOO"
```

`var` can be anything you want as long as it doesn't begin with a number. "FOO" can be anything you want. To access the information from the variable you need to put a '$' in front of it like this:

```{r, eval=FALSE}
echo $var
```

Now create the following e.g. `variables.sh` script in the *Bash* folder and apply the `chmod a+x variables.sh` command on this script using the terminal.

```{r, engine='bash', eval=FALSE}
#!/bin/bash
echo "Now with the read function"
clear
echo "Please enter your name"
read name
echo "Please enter your age"
read age
echo "Please enter your sex. Male/Female"
read sex
echo "So you're a $age year old $sex called $name"
```

You can run the script once it is *executable*:
```{r, engine='bash', eval=FALSE}
./variables.sh
```

If you want to learn more about `Bash` scripting: https://help.ubuntu.com/community/Beginners/BashScripting


## Using the GDAL library from the terminal

A quick refresher:

- ***Do you know who Frank Warmerdam is?*** 
  - Check the the FWtools: 
      - http://fwtools.maptools.org/
      - FWTools is a set of Open Source GIS binaries for Windows (win32) and Linux (x86 32bit) systems produced
  - He's is the man behind GDAL and is now working at [Planet Labs](https://www.planet.com/).

Now via the terminal we can acces GDAL directly!!! E.g. we can check out what the current version of GDAL is that is installed on our Linux OS:

Let's download a file from [Lesson 4 and Raster object manipulations](https://geoscripting-wur.github.io/IntroToRaster/#raster-objects-manipulations):
Download the `gewata.zip` file from Github ([link](https://github.com/GeoScripting-WUR/IntroToRaster/raw/gh-pages/data/gewata.zip)) and unzip in the data folder. Type the following in the data folder:

You can write a shell script to do the following commands below but first type in the commands via the terminal to understand what is happening:

```{r, engine='bash'}
echo "the current GDAL version is:"
gdal-config --version
```

One of the easiest and most useful commands in GDAL is `gdalinfo`. When given an image as an argument, it retrieves and prints all relevant information that is known about the file. This is especially useful if the image contains additional tag data, as is the case with `TIF` files.

Using gdalinfo:

```{r, engine='bash'}
cd data
ls *.tif
gdalinfo -nomd -norat -noct LE71700552001036SGS00_SR_Gewata_INT1U.tif
```

```{r, engine='bash', eval=FALSE}
gdalinfo -nomd -norat -noct LE71700552001036SGS00_SR_Gewata_INT1U.tif
```

Now let's calculate the NDVI via GDAL terminal by using the `gdal_calc.py`:

```{r, engine='bash'}
cd data
cp LE71700552001036SGS00_SR_Gewata_INT1U.tif input.tif
echo "* all files in the directory"
ls
echo "* now apply gdal_calc: Command line raster calculator with numpy syntax"
gdal_calc.py -A input.tif --A_band=4 -B input.tif --B_band=3  --outfile=ndvi.tif  --calc="(A.astype(float)-B)/(A.astype(float)+B)" --type='Float32' --co="COMPRESS=LZW"
echo "* remove the input temporary file"
rm input.tif
```

Challenge:

- try to write to calculate the NDVI using the lines above in out nice and short shell script.
- Hint 1: `cd ../data` (to move back from the Bash folder and move into the data folder)
- Hint 2: No spaces are allowed and e.g. try to use `fn=$(ls *.tif)`

Let's now check if the range of the NDVI values makes sense:
```{r, engine='bash', results='hide'}
cd data
echo "* list all files"
ls -lht
echo "* histogram statistics"
gdalinfo -hist -stats ndvi.tif
```

More info here on the power of GDAL via the terminal:
http://www.gdal.org/ and `gdalinfo`

Handy functions are (See the examples at the bottom):

- `gdal_translate`: http://www.gdal.org/gdal_translate.html
- `gdalwarp`: http://www.gdal.org/gdalwarp.html

More info about `Bash` basics: https://www.gnu.org/software/bash/manual/bashref.html#Command-Substitution

Optional: if you are ready and want the learn more about using GDAL from the terminal. See here for another tutorial:
http://wiki.americaview.org/display/miview/Introduction+to+GDAL

### Excercise

Try to write a shell script that:
 - resampels the Landsat data to pixels of 100m
 - reprojects the landsat data to WGS Lat/long (hint: gdalwarp)
 - convert the *.tif file (i.e. a geotif) to *.png

Copy the text of your shell script in an e-mail per team and set it to me. Do not forget to add a teamname and date at the top of your script.

## More information

See the following tutorial for Geeks! (Warning!: Now you are risking to become a Geek or even computer freak yourself)

- [An overview of terminal commands](http://beginlinux.com/twitter/1094-the-beginners-guide-to-the-ubuntu-terminal)
- http://www.howtogeek.com/140679/beginner-geek-how-to-start-using-the-linux-terminal/
- http://www.howtogeek.com/howto/42980/the-beginners-guide-to-nano-the-linux-command-line-text-editor/
- http://linuxcommand.org/lc3_learning_the_shell.php
- http://www.cyberciti.biz/faq/pwd-linux-unix-command-examples/
- For Mac users and tntroduction to use the terminal on Mac
    - http://computers.tutsplus.com/tutorials/navigating-the-terminal-a-gentle-introduction--mac-3855
    - http://blog.teamtreehouse.com/introduction-to-the-mac-os-x-command-line
    - [Is the terminal in Mac and Linux the same](https://stackoverflow.com/questions/8051145/is-the-terminal-in-mac-and-linux-the-same)
